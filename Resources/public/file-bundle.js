'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=require('lodash');var _lodash2=_interopRequireDefault(_lodash);var _superagent=require('superagent');var _superagent2=_interopRequireDefault(_superagent);var _cache=require('./cache');var _cache2=_interopRequireDefault(_cache);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var Api=function(){function Api(){_classCallCheck(this,Api)}_createClass(Api,[{key:'deleteFile',value:function deleteFile(file_id,onSuccess,onError){var req=_superagent2.default.post('/admin/file/delete/'+file_id);req.end(function(err,res){if(err||res.body.error){onError(res.body.error)}else{_cache2.default.removeFiles([file_id]);onSuccess()}})}},{key:'paste',value:function paste(file_ids,folder_id,onSuccess,onError){var url='/admin/file/move'+(folder_id?'/'+folder_id:'');var req=_superagent2.default.post(url).type('form');req.send({'files[]':file_ids});req.end(function(err,res){if(err){onError(err)}else{var files=_lodash2.default.map(res.body.files,function(file){file.new=true;return file});_cache2.default.removeFiles(file_ids);_cache2.default.storeFiles(files,folder_id);onSuccess()}})}},{key:'addFolder',value:function addFolder(name,folder_id,onSuccess,onError){var url='/admin/file/create/folder'+(folder_id?'/'+folder_id:'');var req=_superagent2.default.post(url).type('form');req.send({name:name});req.end(function(err,res){if(err){onError(err)}else{var folders=_lodash2.default.map(res.body.new_folders,function(folder){folder.new=true;return folder});var errors=[];if(res.body.errors.length>0){errors=[{messages:res.body.errors,type:'folder'}]}_cache2.default.storeFolders(folders,folder_id);onSuccess(errors)}})}},{key:'deleteFolder',value:function deleteFolder(folder_id,onSuccess,onError){var url='/admin/file/delete/folder/'+folder_id;var req=_superagent2.default.post(url).type('form');req.end(function(err,res){if(err){onError()}else{_cache2.default.removeFolders([folder_id]);onSuccess()}})}},{key:'upload',value:function upload(file_list,folder_id,onSuccess,onError){var url='/admin/file/upload'+(folder_id?'/'+folder_id:'');var req=_superagent2.default.post(url);(0,_lodash2.default)(file_list).forEach(function(file){req.attach(file.name,file)});req.end(function(err,res){if(err){onError(err)}else{var files=_lodash2.default.map(res.body.uploads,function(file){file.new=true;return file});var errors=_lodash2.default.map(res.body.errors,function(messages,file){return{type:'upload',file:file,messages:messages}});_cache2.default.storeFiles(files,folder_id);onSuccess(errors)}})}},{key:'openFolder',value:function openFolder(folder_id,onSuccess,onError){_cache2.default.loadFolder(folder_id,function(){// no cache hit
var url='/admin/file/list'+(folder_id?'/'+folder_id:'');var req=_superagent2.default.get(url);req.end(function(err,res){if(err){onError(err);_cache2.default.storeFolder(folder_id,[],[])}else{_cache2.default.storeFolder(folder_id,res.body.folders,res.body.files)}})},function(folders,files){// cache hit
onSuccess()})}}]);return Api}();exports.default=new Api;
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=require('lodash');var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var Cache=function(){function Cache(){_classCallCheck(this,Cache);this.folders={null:{id:null,name:'..'}};this.files={};this.data={}}_createClass(Cache,[{key:'findFile',value:function findFile(id){if(!this.files[id]){console.error('File not found',id);return null}return this.files[id]}},{key:'storeFiles',value:function storeFiles(files,folder_id){var _this=this;_lodash2.default.forEach(files,function(file){_this.files[file.id]=file});if(folder_id!==undefined&&this.data[folder_id]){this.data[folder_id].files=this.data[folder_id].files.concat(files)}}},{key:'removeFiles',value:function removeFiles(file_ids){_lodash2.default.forEach(this.data,function(folder){folder.files=_lodash2.default.filter(folder.files,function(file){return file_ids.indexOf(file.id)===-1})})}},{key:'removeFolders',value:function removeFolders(folder_ids){_lodash2.default.forEach(this.data,function(folder){folder.folders=_lodash2.default.filter(folder.folders,function(folder){return folder_ids.indexOf(folder.id)===-1})})}},{key:'getFiles',value:function getFiles(folder_id){if(!this.data[folder_id]){return[]}return this.data[folder_id].files}},{key:'findFolder',value:function findFolder(id){if(!this.folders[id]){console.error('Folder not found',id);return null}return this.folders[id]}},{key:'storeFolders',value:function storeFolders(folders,folder_id){var _this2=this;_lodash2.default.forEach(folders,function(folder){_this2.folders[folder.id]=folder});if(folder_id!==undefined&&this.data[folder_id]){this.data[folder_id].folders=this.data[folder_id].folders.concat(folders)}}},{key:'loadFolder',value:function loadFolder(key,mis,hit){if(this.data[key]){if(!this.data[key].loading){hit(this.data[key].folders,this.data[key].files)}else{this.data[key].waiting.push(hit)}}else{this.data[key]={loading:true,waiting:[hit]};mis()}}},{key:'getFolders',value:function getFolders(folder_id){if(!this.data[folder_id]){return[]}return this.data[folder_id].folders}},{key:'storeFolder',value:function storeFolder(key,folders,files){if(!this.data[key]){this.data[key]={waiting:[]}}this.data[key].loading=false;this.data[key].folders=folders;this.data[key].files=files;this.storeFolders(folders);this.storeFiles(files);_lodash2.default.forEach(this.data[key].waiting,function(hit){hit(folders,files)})}}]);return Cache}();exports.default=new Cache;
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactFileDragAndDrop=require('react-file-drag-and-drop');var _reactFileDragAndDrop2=_interopRequireDefault(_reactFileDragAndDrop);var _lodash=require('lodash');var _lodash2=_interopRequireDefault(_lodash);var _api=require('../api');var _api2=_interopRequireDefault(_api);var _cache=require('../cache');var _cache2=_interopRequireDefault(_cache);var _listReact=require('./list.react.js');var _listReact2=_interopRequireDefault(_listReact);var _sort_headerReact=require('./sort_header.react.js');var _sort_headerReact2=_interopRequireDefault(_sort_headerReact);var _toolbarReact=require('./toolbar.react.js');var _toolbarReact2=_interopRequireDefault(_toolbarReact);var _selected_filesReact=require('./selected_files.react.js');var _selected_filesReact2=_interopRequireDefault(_selected_filesReact);var _errorsReact=require('./errors.react.js');var _errorsReact2=_interopRequireDefault(_errorsReact);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Browser=function(_React$Component){_inherits(Browser,_React$Component);function Browser(props){_classCallCheck(this,Browser);var _this=_possibleConstructorReturn(this,(Browser.__proto__||Object.getPrototypeOf(Browser)).call(this,props));_this.state={files:[],folders:[],hover:-1,preview:null,selected:_this.getSelected(),clipboard:[],confirm_delete:null,sort:'name',ascending:true,uploading:false,loading_folder:null,expanded:_this.props.browser,current_folder:_cache2.default.findFolder(null),errors:[]};return _this}_createClass(Browser,[{key:'getSelected',value:function getSelected(){var selected=[];if(this.props.options&&this.props.options.selected){selected=this.props.options.selected;_cache2.default.storeFiles(selected);selected=_lodash2.default.map(selected,function(file){return file.id})}return selected}},{key:'componentDidMount',value:function componentDidMount(){this.onOpenFolder(this.state.current_folder.id);if(this.props.browser){document.addEventListener('keydown',this.onKeyDown.bind(this),false)}}},{key:'componentWillUnmount',value:function componentWillUnmount(){if(this.props.browser){document.removeEventListener('keydown',this.onKeyDown.bind(this),false)}}},{key:'render',value:function render(){var _this2=this;var headers=_lodash2.default.map({name:'Naam',size_bytes:'Grootte',create_ts:'Aangemaakt'},function(name,column){return _react2.default.createElement(_sort_headerReact2.default,{key:column,sortBy:_this2.sortBy.bind(_this2),sort:_this2.state.sort,ascending:_this2.state.ascending,column:column,name:name})});var toolbar=_react2.default.createElement(_toolbarReact2.default,{selected:this.state.selected,clipboard:this.state.clipboard,current_folder:this.state.current_folder,browser:this.props.browser,onCut:this.onCut.bind(this),onPaste:this.onPaste.bind(this),onCancel:this.onCancel.bind(this),onUpload:this.onUpload.bind(this),onAddFolder:this.onAddFolder.bind(this),uploading:this.state.uploading,allow_upload:this.props.options?this.props.options.allow_upload:true,allow_new_folder:this.props.options?this.props.options.allow_new_folder:true});var selected=null;if(!this.props.browser&&this.state.selected.length>0){selected=_react2.default.createElement(_selected_filesReact2.default,{selected:this.state.selected,name:this.props.options.name,onSelect:this.onSelect.bind(this),onPreview:this.onPreview.bind(this)})}var browser=null;var browser_class='file-browser text-left'+(this.props.browser?' fullpage':'');if(this.state.expanded){browser=_react2.default.createElement('div',{className:'text-center'},selected,this.state.preview?_react2.default.createElement('div',{className:'preview-image',onClick:this.onPreview.bind(this,null)},_react2.default.createElement('div',{style:{backgroundImage:'url('+this.state.preview+')'}})):null,_react2.default.createElement('div',{className:browser_class},_react2.default.createElement(_reactFileDragAndDrop2.default,{onDrop:this.handleDrop.bind(this)},toolbar,_react2.default.createElement(_errorsReact2.default,{errors:this.state.errors,onDismiss:this.onDismiss.bind(this)}),_react2.default.createElement('div',{ref:'container',className:'table-container'},_react2.default.createElement('table',{className:'table table-condensed'},_react2.default.createElement('thead',null,_react2.default.createElement('tr',null,_react2.default.createElement('th',{className:'select'}),_react2.default.createElement('th',{className:'preview'}),headers,_react2.default.createElement('th',{className:'buttons'}))),_react2.default.createElement(_listReact2.default,{files:this.state.files,folders:this.state.folders,current_folder:this.state.current_folder,onSelect:this.onSelect.bind(this),onPreview:this.onPreview.bind(this),hover:this.state.hover,selected:this.state.selected,clipboard:this.state.clipboard,browser:this.props.browser,confirm_delete:this.state.confirm_delete,loading_folder:this.state.loading_folder,images_only:this.props.options?this.props.options.images_only:false,allow_delete:this.props.options?this.props.options.allow_delete:true,onDelete:this.onDelete.bind(this),onDeleteFolder:this.onDeleteFolder.bind(this),onConfirmDelete:this.onConfirmDelete.bind(this),onOpenFolder:this.onOpenFolder.bind(this)}))))),!this.props.browser?_react2.default.createElement('button',{type:'button',className:'btn btn-default btn-xs collapse-button',onClick:this.toggleExpand.bind(this)},_react2.default.createElement('span',{className:'fa fa-chevron-up'})):null)}else{browser=_react2.default.createElement('div',null,selected,_react2.default.createElement('button',{type:'button',className:'btn btn-default expand-button',onClick:this.toggleExpand.bind(this)},'Bladeren',_react2.default.createElement('span',{className:'fa fa-folder-open-o'})))}return browser}},{key:'onKeyDown',value:function onKeyDown(event){if(event.keyCode===38){this.setHover(this.state.hover-1)}else if(event.keyCode===40){this.setHover(this.state.hover+1)}}},{key:'setHover',value:function setHover(target){var len=this.state.folders.length+this.state.files.length;target=target<0?len-1:target%len;this.setState({hover:target})}},{key:'onPreview',value:function onPreview(state,e){e.stopPropagation();this.setState({preview:state})}},{key:'onDismiss',value:function onDismiss(index){this.state.errors.splice(index,1);this.setState({errors:this.state.errors})}},{key:'onConfirmDelete',value:function onConfirmDelete(id){this.setState({confirm_delete:id})}},{key:'onDelete',value:function onDelete(id){var _this3=this;_api2.default.deleteFile(id,function(){// success
_this3.setState({files:_lodash2.default.sortBy(_cache2.default.getFiles(_this3.state.current_folder.id),_this3.state.sort),confirm_delete:null})},function(){// error
var file=_cache2.default.findFile(id);_this3.setState({confirm_delete:null,errors:[{file:file.name,type:'delete'}]})})}},{key:'onDeleteFolder',value:function onDeleteFolder(id){var _this4=this;_api2.default.deleteFolder(id,function(){// success
_this4.setState({folders:_lodash2.default.sortBy(_cache2.default.getFolders(_this4.state.current_folder.id),_this4.state.sort)})},function(){// error
var folder=_cache2.default.findFolder(id);_this4.setState({confirm_delete:null,errors:[{folder:folder.name,type:'delete_folder'}]})})}},{key:'onCut',value:function onCut(){this.setState({selected:[],clipboard:this.state.selected})}},{key:'onCancel',value:function onCancel(){this.setState({selected:[],clipboard:[]})}},{key:'onPaste',value:function onPaste(){var _this5=this;_api2.default.paste(this.state.clipboard,this.state.current_folder.id,function(){// success
_this5.setState({files:_lodash2.default.sortBy(_cache2.default.getFiles(_this5.state.current_folder.id),_this5.state.sort),selected:[],clipboard:[]})},function(){// error
_this5.setState({selected:[],clipboard:[]})})}},{key:'onSelect',value:function onSelect(id){if(this.state.clipboard.length>0){return}var index=this.state.selected.indexOf(id);if(!this.props.browser&&!this.props.options.multiple){if(index>-1){this.state.selected=[]}else{this.state.selected=[id];this.state.expanded=false}}else if(index>-1){this.state.selected.splice(index,1)}else{this.state.selected.push(id)}this.setState({selected:this.state.selected,expanded:this.state.expanded})}},{key:'sortBy',value:function sortBy(column){if(this.state.sort===column){this.state.ascending=!this.state.ascending}var folders=_lodash2.default.sortBy(this.state.folders,column);var files=_lodash2.default.sortBy(this.state.files,column);this.setState({ascending:this.state.ascending,sort:column,folders:this.state.ascending?folders:folders.reverse(),files:this.state.ascending?files:files.reverse()})}},{key:'toggleExpand',value:function toggleExpand(){this.setState({expanded:!this.state.expanded})}},{key:'handleDrop',value:function handleDrop(dataTransfer){if(this.props.options&&this.props.options.allow_upload===true){this.doUpload(dataTransfer.files)}}},{key:'onUpload',value:function onUpload(event){this.doUpload(event.target.files)}},{key:'onOpenFolder',value:function onOpenFolder(id){var _this6=this;if(this.state.uploading||this.state.loading_folder){return}// store the selected folder
var folder=_cache2.default.findFolder(id);this.setState({loading_folder:id});_api2.default.openFolder(id,function(){// success
_this6.setState({hover:-1,folders:_lodash2.default.sortBy(_cache2.default.getFolders(id),_this6.state.sort),files:_lodash2.default.sortBy(_cache2.default.getFiles(id),_this6.state.sort),current_folder:folder,loading_folder:null})},function(){// error
_this6.setState({loading_folder:null})})}},{key:'onAddFolder',value:function onAddFolder(errors){this.setState({folders:_lodash2.default.sortBy(_cache2.default.getFolders(this.state.current_folder.id),this.state.sort),sort:'create_ts',ascending:false,errors:errors})}},{key:'doUpload',value:function doUpload(file_list){var _this7=this;if(this.state.uploading||this.state.loading_folder){return}this.setState({uploading:true});_api2.default.upload(file_list,this.state.current_folder.id,function(errors){// success
_this7.setState({files:_lodash2.default.sortBy(_cache2.default.getFiles(_this7.state.current_folder.id),_this7.state.sort),uploading:false,sort:'create_ts',ascending:false,errors:errors});// scroll to top after upload
_this7.refs.container.scrollTop=0},function(){// error
_this7.setState({uploading:false})})}}]);return Browser}(_react2.default.Component);exports.default=Browser;
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _lodash=require('lodash');var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var UploadErrors=function(_React$Component){_inherits(UploadErrors,_React$Component);function UploadErrors(){_classCallCheck(this,UploadErrors);return _possibleConstructorReturn(this,(UploadErrors.__proto__||Object.getPrototypeOf(UploadErrors)).apply(this,arguments))}_createClass(UploadErrors,[{key:'render',value:function render(){var _this2=this;var messages=_lodash2.default.map(this.props.errors,function(error,index){var message=null;if(error.type==='upload'){message=_react2.default.createElement('span',null,_react2.default.createElement('strong',null,'Uploaden van "',error.file,'" niet gelukt.'),error.messages.join(' '))}else if(error.type==='delete'){message=_react2.default.createElement('span',null,_react2.default.createElement('strong',null,'Verwijderen van "',error.file,'" niet gelukt.'),'Het bestand is in gebruik.')}else if(error.type==='delete_folder'){message=_react2.default.createElement('span',null,_react2.default.createElement('strong',null,'Verwijderen van "',error.folder,'" niet gelukt.'),'De map is niet helemaal leeg.')}else{message=_react2.default.createElement('span',null,error.messages.join(' '))}return _react2.default.createElement('div',{key:index,className:'alert alert-danger alert-dismissible'},_react2.default.createElement('button',{type:'button',className:'close',onClick:_this2.props.onDismiss.bind(_this2,index)},'\xD7'),_react2.default.createElement('span',{className:'fa fa-bell-o'}),message)});return _react2.default.createElement('div',null,messages)}}]);return UploadErrors}(_react2.default.Component);exports.default=UploadErrors;
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var icons={pdf:'file-pdf-o',doc:'file-word-o',docx:'file-word-o',ppt:'file-powerpoint-o',pptx:'file-powerpoint-o',xls:'file-excel-o',xlsx:'file-excel-o'};var File=function(_React$Component){_inherits(File,_React$Component);function File(props){_classCallCheck(this,File);var _this=_possibleConstructorReturn(this,(File.__proto__||Object.getPrototypeOf(File)).call(this,props));_this.state={confirm_delete:false,preview:false};_this.onDelete=_this.onDelete.bind(_this);_this.onCancelDelete=_this.onCancelDelete.bind(_this);_this.onConfirmDelete=_this.onConfirmDelete.bind(_this);return _this}_createClass(File,[{key:'render',value:function render(){var file=this.props.file;var checked=this.props.clipboard.indexOf(file.id)>-1;var selected=this.props.selected.indexOf(file.id)>-1;var class_name='cutable'+(this.props.hovering?' selected':'');var preview=_react2.default.createElement('span',{className:'fa fa-'+(icons[file.type]?icons[file.type]:'file')});var checkbox=null;var actions=null;var confirm=null;var delete_btn=null;var download_btn=null;if(this.props.confirm_delete===file.id){confirm=_react2.default.createElement('div',{className:'confirm'},_react2.default.createElement('button',{type:'button',className:'btn btn-sm btn-primary',onClick:this.onCancelDelete},_react2.default.createElement('span',{className:'text-label'},'Annuleren'),_react2.default.createElement('span',{className:'fa fa-times'})),_react2.default.createElement('button',{type:'button',className:'btn btn-sm btn-danger',onClick:this.onDelete},_react2.default.createElement('span',{className:'text-label'},'Definitief verwijderen'),_react2.default.createElement('span',{className:'fa fa-trash-o'})))}else if(this.props.selected.length+this.props.clipboard.length===0&&this.props.allow_delete===true){delete_btn=_react2.default.createElement('button',{type:'button',className:'btn btn-sm btn-danger',onClick:this.onConfirmDelete},_react2.default.createElement('span',{className:'fa fa-trash-o'}))}if(this.props.browser){if(this.props.confirm_delete!==file.id){download_btn=_react2.default.createElement('a',{className:'btn btn-sm btn-primary',title:'Download',download:file.name,href:file.original,onClick:function onClick(e){return e.stopPropagation()}},_react2.default.createElement('span',{className:'fa fa-download'}))}checkbox=_react2.default.createElement('input',{type:'checkbox',checked:selected});actions=_react2.default.createElement('div',{className:'actions'},delete_btn,download_btn,confirm)}else{checkbox=_react2.default.createElement('span',{className:selected?'fa fa-check-square-o':'fa fa-square-o'});class_name=selected?'selected':'selectable'}if(this.props.clipboard.length>0){checkbox=_react2.default.createElement('span',{className:checked?'fa fa-thumb-tack':''});class_name=checked?'cut':''}if(this.props.confirm_delete===file.id){class_name+=' danger'}if(file.new){class_name+=' success'}if(file.thumb){preview=_react2.default.createElement('img',{src:file.thumb,alt:file.name,onClick:this.props.onPreview.bind(this,file.original)})}return _react2.default.createElement('tr',{className:class_name,onClick:this.props.onSelect.bind(this,file.id)},_react2.default.createElement('td',{className:'select'},checkbox),_react2.default.createElement('td',{className:'preview'},preview),_react2.default.createElement('td',{className:'name'},file.name),_react2.default.createElement('td',{className:'size'},file.size),_react2.default.createElement('td',{className:'date'},file.created),_react2.default.createElement('td',{className:'buttons'},actions))}},{key:'onDelete',value:function onDelete(e){e.stopPropagation();this.props.onDelete(this.props.file.id)}},{key:'onCancelDelete',value:function onCancelDelete(e){e.stopPropagation();this.props.onConfirmDelete(null)}},{key:'onConfirmDelete',value:function onConfirmDelete(e){e.stopPropagation();this.props.onConfirmDelete(this.props.file.id)}}]);return File}(_react2.default.Component);exports.default=File;
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Folder=function(_React$Component){_inherits(Folder,_React$Component);function Folder(){_classCallCheck(this,Folder);return _possibleConstructorReturn(this,(Folder.__proto__||Object.getPrototypeOf(Folder)).apply(this,arguments))}_createClass(Folder,[{key:'render',value:function render(){var folder=this.props.folder;var class_name='folder'+(folder.new?' success':'')+(this.props.hovering?' selected':'');var icon=_react2.default.createElement('span',{className:'fa fa-folder'});var delete_btn=null;if(folder.file_count===0&&folder.folder_count===0&&this.props.allow_delete===true){delete_btn=_react2.default.createElement('button',{type:'button',className:'btn btn-sm btn-danger',onClick:this.onDelete.bind(this)},_react2.default.createElement('span',{className:'fa fa-trash-o'}))}if(this.props.loading&&this.props.loading===folder.id){icon=_react2.default.createElement('span',{className:'fa fa-circle-o-notch fa-spin'})}if(this.props.parent){icon=_react2.default.createElement('span',{className:'fa fa-chevron-up'});// class_name = 'folder muted';
}var file_count=null;if(folder.file_count>0){file_count=_react2.default.createElement('span',null,folder.file_count,_react2.default.createElement('span',{className:'fa fa-file-o'}))}var folder_count=null;if(folder.folder_count>0){folder_count=_react2.default.createElement('span',null,folder.folder_count,_react2.default.createElement('span',{className:'fa fa-folder-o'}))}return _react2.default.createElement('tr',{className:class_name,onClick:this.props.onOpenFolder.bind(this,folder.id)},_react2.default.createElement('td',{className:'select'}),_react2.default.createElement('td',{className:'preview'},icon),_react2.default.createElement('td',{className:'name'},folder.name),_react2.default.createElement('td',{className:'size'},folder_count,file_count),_react2.default.createElement('td',{className:'date'},folder.created),_react2.default.createElement('td',{className:'buttons'},delete_btn))}},{key:'onDelete',value:function onDelete(e){e.stopPropagation();this.props.onDelete(this.props.folder.id)}}]);return Folder}(_react2.default.Component);exports.default=Folder;
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _lodash=require('lodash');var _lodash2=_interopRequireDefault(_lodash);var _cache=require('../cache');var _cache2=_interopRequireDefault(_cache);var _fileReact=require('./file.react.js');var _fileReact2=_interopRequireDefault(_fileReact);var _folderReact=require('./folder.react.js');var _folderReact2=_interopRequireDefault(_folderReact);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var List=function(_React$Component){_inherits(List,_React$Component);function List(){_classCallCheck(this,List);return _possibleConstructorReturn(this,(List.__proto__||Object.getPrototypeOf(List)).apply(this,arguments))}_createClass(List,[{key:'render',value:function render(){var _this2=this;// sorted file listing
var files=_lodash2.default.map(this.props.files,function(file,index){// hide non-images when the images only option is passed to the form
if(!_this2.props.browser&&_this2.props.images_only&&!file.thumb){return}index=_this2.props.ascending?_this2.props.folders.length+index:_this2.props.folders.length+_this2.props.files.length-index-1;return _react2.default.createElement(_fileReact2.default,{key:'file-'+file.id,file:file,hovering:_this2.props.hover===index,onSelect:_this2.props.onSelect.bind(_this2),onPreview:_this2.props.onPreview.bind(_this2),selected:_this2.props.selected,clipboard:_this2.props.clipboard,browser:_this2.props.browser,confirm_delete:_this2.props.confirm_delete,onDelete:_this2.props.onDelete.bind(_this2),onConfirmDelete:_this2.props.onConfirmDelete.bind(_this2),allow_delete:_this2.props.allow_delete})});// sorted folder listing
var folders=_lodash2.default.map(this.props.folders,function(folder,index){index=_this2.props.ascending?index:_this2.props.files.length-index+1;return _react2.default.createElement(_folderReact2.default,{hovering:_this2.props.hover===index,key:'folder-'+folder.id,parent:false,folder:folder,onOpenFolder:_this2.props.onOpenFolder.bind(_this2),onDelete:_this2.props.onDeleteFolder.bind(_this2),loading:_this2.props.loading_folder,allow_delete:_this2.props.allow_delete})});// reverse listings when the sort direction is reversed
if(!this.props.ascending){folders=folders.reverse();files=files.reverse()}// show parent directory button
var parent=null;if(this.props.current_folder.parent!==undefined){parent=_react2.default.createElement(_folderReact2.default,{key:'folder-'+this.props.current_folder.parent,parent:true,folder:_cache2.default.findFolder(this.props.current_folder.parent),loading:this.props.loading_folder,onOpenFolder:this.props.onOpenFolder.bind(this)})}return _react2.default.createElement('tbody',null,parent,folders,files)}}]);return List}(_react2.default.Component);exports.default=List;
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _lodash=require('lodash');var _lodash2=_interopRequireDefault(_lodash);var _cache=require('../cache');var _cache2=_interopRequireDefault(_cache);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SelectedFiles=function(_React$Component){_inherits(SelectedFiles,_React$Component);function SelectedFiles(){_classCallCheck(this,SelectedFiles);return _possibleConstructorReturn(this,(SelectedFiles.__proto__||Object.getPrototypeOf(SelectedFiles)).apply(this,arguments))}_createClass(SelectedFiles,[{key:'render',value:function render(){var _this2=this;var files=_lodash2.default.map(this.props.selected,function(id){var file=_cache2.default.findFile(id);var preview=_react2.default.createElement('span',{className:'fa fa-file'});if(file.thumb){preview=_react2.default.createElement('img',{src:file.thumb,alt:file.name,onClick:_this2.props.onPreview.bind(_this2,file.original)})}return _react2.default.createElement('div',{key:id,className:'btn btn-default',onClick:_this2.props.onSelect.bind(_this2,id)},preview,_react2.default.createElement('span',{className:'name'},file.name),_react2.default.createElement('span',{className:'remove'},'\xD7'),_react2.default.createElement('input',{type:'hidden',name:_this2.props.name,value:id}))});if(files.length===0){files=_react2.default.createElement('span',{className:'none-selected'},'Geen bestand(en) geselecteerd.')}return _react2.default.createElement('div',{className:'text-left file-picker-selection'},files)}}]);return SelectedFiles}(_react2.default.Component);exports.default=SelectedFiles;
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SortHeader=function(_React$Component){_inherits(SortHeader,_React$Component);function SortHeader(props){_classCallCheck(this,SortHeader);var _this=_possibleConstructorReturn(this,(SortHeader.__proto__||Object.getPrototypeOf(SortHeader)).call(this,props));_this.class_names={name:'name',size_bytes:'size',create_ts:'date'};return _this}_createClass(SortHeader,[{key:'render',value:function render(){var sort_class=null;if(this.props.sort===this.props.column){sort_class=this.props.ascending?'fa fa-sort-down':'fa fa-sort-up'}var className='sort '+this.class_names[this.props.column];return _react2.default.createElement('th',{onClick:this.props.sortBy.bind(this,this.props.column),className:className},this.props.name,_react2.default.createElement('span',{className:sort_class}))}}]);return SortHeader}(_react2.default.Component);exports.default=SortHeader;
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _api=require('../api');var _api2=_interopRequireDefault(_api);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Toolbar=function(_React$Component){_inherits(Toolbar,_React$Component);function Toolbar(props){_classCallCheck(this,Toolbar);var _this=_possibleConstructorReturn(this,(Toolbar.__proto__||Object.getPrototypeOf(Toolbar)).call(this,props));_this.state={show_form:false,folder_loading:false};return _this}_createClass(Toolbar,[{key:'render',value:function render(){var loader=this.props.uploading?_react2.default.createElement('span',{className:'fa fa-circle-o-notch fa-spin'}):null;var new_folder_class='btn btn-sm btn-default pull-right '+(this.state.show_form?'hide':'');var actions=null;if(this.props.browser){actions=_react2.default.createElement('div',{className:'pull-left'},_react2.default.createElement('button',{type:'button',className:'btn btn-sm btn-default',disabled:this.props.selected.length===0,onClick:this.props.onCut.bind(this)},_react2.default.createElement('span',{className:'fa fa-cut'}),_react2.default.createElement('span',{className:'text-label'},'Knippen'),this.props.selected.length>0?' ('+this.props.selected.length+')':null),_react2.default.createElement('button',{type:'button',className:'btn btn-sm btn-default',disabled:this.props.clipboard.length===0,onClick:this.props.onPaste.bind(this)},_react2.default.createElement('span',{className:'fa fa-paste'}),_react2.default.createElement('span',{className:'text-label'},'Plakken'),this.props.clipboard.length>0?' ('+this.props.clipboard.length+')':null),_react2.default.createElement('button',{type:'button',className:'btn btn-sm btn-default',disabled:this.props.clipboard.length+this.props.selected.length===0,onClick:this.props.onCancel.bind(this)},_react2.default.createElement('span',{className:'fa fa-times-circle-o'}),_react2.default.createElement('span',{className:'text-label'},'Annuleren')))}var newFolderButton=_react2.default.createElement('button',{type:'button',className:new_folder_class,onClick:this.onShowForm.bind(this),disabled:this.state.folder_loading},_react2.default.createElement('span',{className:'fa fa-folder-o'}),_react2.default.createElement('span',{className:'text-label'},'Nieuwe map'),this.state.folder_loading?_react2.default.createElement('span',{className:'fa fa-circle-o-notch fa-spin'}):null);var newFolderForm=_react2.default.createElement('div',{className:'form-inline pull-right '+(this.state.show_form?'':'hide')},_react2.default.createElement('input',{className:'form-control input-sm',ref:'folder_name',type:'text',placeholder:'Mapnaam',onKeyPress:this.onKeyPress.bind(this)}),_react2.default.createElement('button',{type:'button',className:'btn btn-sm btn-success pull-right',onClick:this.onAddFolder.bind(this)},_react2.default.createElement('span',{className:'fa fa-save'}),_react2.default.createElement('span',{className:'text-label'},'Opslaan')));if(this.props.allow_new_folder===false){newFolderButton=null;newFolderForm=null}var uploadButton=_react2.default.createElement('span',{className:'btn btn-sm btn-default btn-file pull-right',disabled:this.props.uploading},_react2.default.createElement('span',{className:'fa fa-arrow-circle-o-up'}),_react2.default.createElement('span',{className:'text-label'},'Upload'),loader,_react2.default.createElement('input',{type:'file',multiple:'multiple',onChange:this.props.onUpload}));if(this.props.allow_upload===false){uploadButton=null}return _react2.default.createElement('div',{className:'toolbar'},newFolderButton,actions,newFolderForm,uploadButton)}},{key:'onKeyPress',value:function onKeyPress(e){if(e.which===13){e.preventDefault();this.onAddFolder()}}},{key:'onShowForm',value:function onShowForm(){var _this2=this;this.setState({show_form:true},function(){_this2.refs.folder_name.focus()})}},{key:'reset',value:function reset(){this.setState({show_form:false,folder_loading:false});this.refs.folder_name.value=''}},{key:'onAddFolder',value:function onAddFolder(){var _this3=this;this.setState({folder_loading:true});_api2.default.addFolder(this.refs.folder_name.value,this.props.current_folder.id,function(errors){// success
_this3.reset();_this3.props.onAddFolder(errors)},function(){// error
_this3.reset()})}}]);return Toolbar}(_react2.default.Component);exports.default=Toolbar;
'use strict';var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactDom=require('react-dom');var _reactDom2=_interopRequireDefault(_reactDom);var _browserReact=require('./components/browser.react.js');var _browserReact2=_interopRequireDefault(_browserReact);var _lodash=require('lodash');var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}// an element with the id 'tg_file_browser' will be converted to a interactive file browser
// note that there can only be one of these
var browser=document.getElementById('tg_file_browser');var options={allow_new_folder:true,allow_upload:true,allow_delete:true};if(null!==browser){_reactDom2.default.render(_react2.default.createElement(_browserReact2.default,{browser:true,options:options}),browser)}// an element with the class 'tg_file_picker' will be converted to a file selector
// note there can be multiple file selectors in a single form
var pickers=document.getElementsByClassName('tg_file_picker');if(pickers.length>0){_lodash2.default.forEach(pickers,function(element){var options=JSON.parse(element.dataset.options);_reactDom2.default.render(_react2.default.createElement(_browserReact2.default,{browser:false,options:options}),element)})}
